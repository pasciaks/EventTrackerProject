<!DOCTYPE html>
<html lang="en">
<head>
<title>Event Tracker - Cities</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous">

<style>
.state {
	cursor: pointer;
	width: 100px;
	height: 50px;
	font-size: 10px;
	margin: 5px;
	padding: 0px;
}

.state:hover {
	box-shadow: 5px 5px 5px gray;
}
</style>
</head>
<body>



	<div class="container">
		<div class="row">

			<div class="col text-center">
				<h3>
					<a href="https://github.com/pasciaks/EventTrackerProject#readme">Event
						Tracker - About</a>
				</h3>
				<p>Sheldon Pasciak, Skill Distillery</p>
				<div class="alert alert-primary" role="alert">
					The dataset that was used to populate the 31k + cities for this
					project was downloaded for free from <a
						href="https://simplemaps.com/data/us-cities">https://simplemaps.com/data/us-cities.</a>
				</div>

			</div>
		</div>
	</div>



	<div class="container-fluid">

		<div class="row">

			<div class="col text-center">
				<canvas id="myCanvas" width="800" height="600"></canvas>
			</div>

			<div class="col text-center">
				<div class="row">
					<div class="col text-center">
						<h1>List of States</h1>
						<div class="container">
							<div class="row" id="stateDiv"></div>
						</div>
					</div>
				</div>

			</div>
		</div>

		<div class="row">
			<div class="col text-center">
				<h1>List of Cities In State</h1>
				<div id="cityList"></div>
			</div>
		</div>


	</div>

	<script>
	
	    let myCanvas = document.getElementById("myCanvas");
	    
	    let ctx = myCanvas.getContext("2d");
	    
	    ctx.fillStyle = "white";
	    
	    ctx.fillRect(10, 10, 790, 590);
	    
	    let statesList = [];
	    
		let drawPoints = function(lat,lng,clrString='red') {
				let x = (lng + 180) * (myCanvas.width / 120);
				let y = (90 - lat) * (myCanvas.height / 90); 
				ctx.fillStyle = clrString;
				ctx.fillRect(x-1, y-1, 2, 2);
			}
		
		let loadCities = function(stateName) {
		      	let url=`/api/cities`;
	            fetch(url)
	            .then(response => response.json())
	            .then(data => {
	                data.forEach(city => {
	                    drawPoints(city.lat,city.lng,'black');
	                });
	            })
	            .catch(error => console.error('Error fetching cities:', error));
	      
		};
		
		let loadCitiesForState = function(stateName) {
	       
	        	let url=`/api/cities/states/${stateName}`;
	            fetch(url)
	            .then(response => response.json())
	            .then(data => {
	                const cityList = document.getElementById('cityList');
	                cityList.childNodes.forEach(child => {
						cityList.removeChild(child);
					});
	                data.forEach(city => {
	                    const item = document.createElement('span');
	                    item.style.margin = '5px';
	                    item.style.padding = '5px';
	                    item.textContent = city.city;
	                    cityList.appendChild(item);
	                    drawPoints(city.lat,city.lng,'red');
	                });
	            })
	            .catch(error => console.error('Error fetching cities:', error));
	       
		};
			
	    let loadStates = function () {
		      	let url=`/api/cities/states`;
	            fetch(url)
				.then(response => response.json())
				.then(data => {
					data.forEach(state => {
						
						const stateDiv = document.getElementById('stateDiv');
						const card = document.createElement('div');
						card.classList.add('card','col-2','state');
						const cardBody = document.createElement('div');
						cardBody.classList.add('card-body');
			
						cardBody.textContent = state;
						
						cardBody.addEventListener('click', () => {
							loadCitiesForState(state);
						});
						
						card.appendChild(cardBody);
						stateDiv.appendChild(card);
						
						statesList.push(state);
					});
				})
				.catch(error => console.error('Error fetching states:', error));
			
	    };
	    
		document.addEventListener("DOMContentLoaded", function () {

			loadStates();
			
			let citiesLoader = new Promise((resolve,reject) => {

			    loadCities();
			    
			    setTimeout(() => {
					 resolve("Success");
				}, 1000);
			    
			});
			
			citiesLoader.then(message => {
				if (message === "Success") {
					//let randomState = Math.floor(Math.random() * statesList.length);
					//console.log("Random State: " + statesList[randomState]);
					//loadCitiesForState(statesList[randomState]);
				}
			});
        
	    
		});
		
    </script>

</body>

</html>




