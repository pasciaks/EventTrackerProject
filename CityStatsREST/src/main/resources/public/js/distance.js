

let statesObj = {
	AL: {
		name: "Alabama",
		capital: "Montgomery",
		lat: "32.361538",
		long: "-86.279118",
	},
	AK: {
		name: "Alaska",
		capital: "Juneau",
		lat: "58.301935",
		long: "-134.419740",
	},
	AZ: {
		name: "Arizona",
		capital: "Phoenix",
		lat: "33.448457",
		long: "-112.073844",
	},
	AR: {
		name: "Arkansas",
		capital: "Little Rock",
		lat: "34.736009",
		long: "-92.331122",
	},
	CA: {
		name: "California",
		capital: "Sacramento",
		lat: "38.555605",
		long: "-121.468926",
	},
	CO: {
		name: "Colorado",
		capital: "Denver",
		lat: "39.7391667",
		long: "-104.984167",
	},
	CT: {
		name: "Connecticut",
		capital: "Hartford",
		lat: "41.767",
		long: "-72.677",
	},
	DE: {
		name: "Delaware",
		capital: "Dover",
		lat: "39.161921",
		long: "-75.526755",
	},
	FL: {
		name: "Florida",
		capital: "Tallahassee",
		lat: "30.4518",
		long: "-84.27277",
	},
	GA: {
		name: "Georgia",
		capital: "Atlanta",
		lat: "33.76",
		long: "-84.39",
	},
	HI: {
		name: "Hawaii",
		capital: "Honolulu",
		lat: "21.30895",
		long: "-157.826182",
	},
	ID: {
		name: "Idaho",
		capital: "Boise",
		lat: "43.613739",
		long: "-116.237651",
	},
	IL: {
		name: "Illinois",
		capital: "Springfield",
		lat: "39.783250",
		long: "-89.650373",
	},
	IN: {
		name: "Indiana",
		capital: "Indianapolis",
		lat: "39.790942",
		long: "-86.147685",
	},
	IA: {
		name: "Iowa",
		capital: "Des Moines",
		lat: "41.590939",
		long: "-93.620866",
	},
	KS: {
		name: "Kansas",
		capital: "Topeka",
		lat: "39.04",
		long: "-95.69",
	},
	KY: {
		name: "Kentucky",
		capital: "Frankfort",
		lat: "38.197274",
		long: "-84.86311",
	},
	LA: {
		name: "Louisiana",
		capital: "Baton Rouge",
		lat: "30.45809",
		long: "-91.140229",
	},
	ME: {
		name: "Maine",
		capital: "Augusta",
		lat: "44.323535",
		long: "-69.765261",
	},
	MD: {
		name: "Maryland",
		capital: "Annapolis",
		lat: "38.972945",
		long: "-76.501157",
	},
	MA: {
		name: "Massachusetts",
		capital: "Boston",
		lat: "42.2352",
		long: "-71.0275",
	},
	MI: {
		name: "Michigan",
		capital: "Lansing",
		lat: "42.7335",
		long: "-84.5467",
	},
	MN: {
		name: "Minnesota",
		capital: "Saint Paul",
		lat: "44.95",
		long: "-93.094",
	},
	MS: {
		name: "Mississippi",
		capital: "Jackson",
		lat: "32.320",
		long: "-90.207",
	},
	MO: {
		name: "Missouri",
		capital: "Jefferson City",
		lat: "38.572954",
		long: "-92.189283",
	},
	MT: {
		name: "Montana",
		capital: "Helana",
		lat: "46.595805",
		long: "-112.027031",
	},
	NE: {
		name: "Nebraska",
		capital: "Lincoln",
		lat: "40.809868",
		long: "-96.675345",
	},
	NV: {
		name: "Nevada",
		capital: "Carson City",
		lat: "39.160949",
		long: "-119.753877",
	},
	NH: {
		name: "New Hampshire",
		capital: "Concord",
		lat: "43.220093",
		long: "-71.549127",
	},
	NJ: {
		name: "New Jersey",
		capital: "Trenton",
		lat: "40.221741",
		long: "-74.756138",
	},
	NM: {
		name: "New Mexico",
		capital: "Santa Fe",
		lat: "35.667231",
		long: "-105.964575",
	},
	NY: {
		name: "New York",
		capital: "Albany",
		lat: "42.659829",
		long: "-73.781339",
	},
	NC: {
		name: "North Carolina",
		capital: "Raleigh",
		lat: "35.771",
		long: "-78.638",
	},
	ND: {
		name: "North Dakota",
		capital: "Bismarck",
		lat: "48.813343",
		long: "-100.779004",
	},
	OH: {
		name: "Ohio",
		capital: "Columbus",
		lat: "39.962245",
		long: "-83.000647",
	},
	OK: {
		name: "Oklahoma",
		capital: "Oklahoma City",
		lat: "35.482309",
		long: "-97.534994",
	},
	OR: {
		name: "Oregon",
		capital: "Salem",
		lat: "44.931109",
		long: "-123.029159",
	},
	PA: {
		name: "Pennsylvania",
		capital: "Harrisburg",
		lat: "40.269789",
		long: "-76.875613",
	},
	RI: {
		name: "Rhode Island",
		capital: "Providence",
		lat: "41.82355",
		long: "-71.422132",
	},
	SC: {
		name: "South Carolina",
		capital: "Columbia",
		lat: "34.000",
		long: "-81.035",
	},
	SD: {
		name: "South Dakota",
		capital: "Pierre",
		lat: "44.367966",
		long: "-100.336378",
	},
	TN: {
		name: "Tennessee",
		capital: "Nashville",
		lat: "36.165",
		long: "-86.784",
	},
	TX: {
		name: "Texas",
		capital: "Austin",
		lat: "30.266667",
		long: "-97.75",
	},
	UT: {
		name: "Utah",
		capital: "Salt Lake City",
		lat: "40.7547",
		long: "-111.892622",
	},
	VT: {
		name: "Vermont",
		capital: "Montpelier",
		lat: "44.26639",
		long: "-72.57194",
	},
	VA: {
		name: "Virginia",
		capital: "Richmond",
		lat: "37.54",
		long: "-77.46",
	},
	WA: {
		name: "Washington",
		capital: "Olympia",
		lat: "47.042418",
		long: "-122.893077",
	},
	WV: {
		name: "West Virginia",
		capital: "Charleston",
		lat: "38.349497",
		long: "-81.633294",
	},
	WI: {
		name: "Wisconsin",
		capital: "Madison",
		lat: "43.074722",
		long: "-89.384444",
	},
	WY: {
		name: "Wyoming",
		capital: "Cheyenne",
		lat: "41.145548",
		long: "-104.802042",
	},
};

// create ahref with each state key and a lat and lng query string
let stateLinks = "";
for (let state in statesObj) {
	stateLinks += `<a class="" href="distance.html?lat=${statesObj[state].lat}&lng=${statesObj[state].long}&capital=${statesObj[state].capital}"><span>${state}</span></a> `;
}

document.getElementById("stateLinks").innerHTML = stateLinks;
/*
const cityUtilityResults = new Promise((resolve, reject) => {
	let miles = document.getElementById('rangePickerMiles').value;
	let lat = document.getElementById('rangePickerLat').value;
	let lng = document.getElementById('rangePickerLng').value;
	let url = urlPrefix + `api/cities/distances?lat=${lat}&lng=${lng}&howFar=${miles}`;
	fetch(url)
		.then((response) => response.json())
		.then((data) => {

			console.log(data);

			let cities = [];

			data.forEach((item) => {
				let city = {
					id: item[0],
					city: item[1],
					state: item[2],
					distance: item[3]
				};
				console.log(city);
				cities.push(city);

			});

			return cities;
		}).then((cities) => {
			resolve(cities);
		})
		.catch((error) => {
			reject(error);
		});
});
*/

const setUp = () => {

	document.getElementById("executeSearch").addEventListener("click", function(event) {
		event.preventDefault();

		//cityUtilityResults.then(fnSuccess).catch(fnError)

		let miles = document.getElementById('miles').value;
		let lat = document.getElementById('lat').value;
		let lng = document.getElementById('lng').value;
		let url = urlPrefix + `api/cities/distances?lat=${lat}&lng=${lng}&howFar=${miles}`;
		fetch(url)
			.then((response) => response.json())
			.then((data) => {

				console.log(data);

				let cities = [];

				data.forEach((item) => {
					let city = {
						id: item[0],
						city: item[1],
						state: item[2],
						distance: item[3]
					};
					console.log(city);
					cities.push(city);

				});

				fnSuccess(cities);
				console.log(cities);
				return cities;
			})
			.catch((error) => {
				fnError(error);
				console.log(error);
				return error;
			});


	});

	if (getParameterByName("capital")) {
		document.getElementById('selectedStateCapital').textContent = "Chosen Capital: " + getParameterByName("capital");
	} else {
		// document.getElementById('selectedStateCapital').textContent = "";
	}

	if (getParameterByName("lat")) {
		document.getElementById('rangePickerLat').value = getParameterByName("lat");
	}

	if (getParameterByName("lng")) {
		document.getElementById('rangePickerLng').value = getParameterByName("lng");
	}

	document.getElementById('rangePickerMiles').addEventListener('input', function() {
		document.getElementById('miles').value = this.value;
	});

	document.getElementById('rangePickerLat').addEventListener('input', function() {
		document.getElementById('lat').value = this.value;
	});

	document.getElementById('rangePickerLng').addEventListener('input', function() {
		document.getElementById('lng').value = this.value;
	});

	document.getElementById('miles').value = document.getElementById('rangePickerMiles').value;
	document.getElementById('lat').value = document.getElementById('rangePickerLat').value;
	document.getElementById('lng').value = document.getElementById('rangePickerLng').value;



};

const fnSuccess = (data) => {

	console.log(data);

	tableUtility.clickHandler = function(event) {
		event.preventDefault();
		console.log("!!You clicked on a table row!");
		console.log(event.target.parentElement.firstChild.textContent);
		let cityId = Number(event.target.parentElement.dataset.id);
		window.location.href = `detail.html?id=${cityId}`;
	};

	let newTable = tableUtility.createTable(data, "id");
	document.getElementById("table").innerHTML = "";
	document.getElementById("table").appendChild(newTable);
	document.getElementById("countOfRows").textContent = data.length;
};

const fnError = (error) => {
	console.log(error);
	alert("There was an error. Please try again later.");
};

setUp();


